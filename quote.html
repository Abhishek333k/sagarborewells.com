<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Quote | Sagar Borewells</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: white; }
        .glass-panel { background: #1e293b; border: 1px solid #334155; border-radius: 1rem; }
        /* Smooth transitions for the multi-step form */
        .step-section { transition: all 0.4s ease-in-out; }
        .hidden-step { display: none; opacity: 0; }
        
        /* Custom Number Input to look like text */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-[#0f172a] border-b border-slate-800 p-4 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight">SAGAR <span class="text-blue-500">OPS</span></h1>
            <a href="tel:+919876543210" class="text-xs font-bold text-slate-400"><i class="fa-solid fa-phone"></i> Help</a>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-3xl">
        
        <div class="flex items-center justify-between mb-8 px-4">
            <div id="step1-indicator" class="flex flex-col items-center text-blue-500">
                <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm">1</div>
                <span class="text-[10px] font-bold mt-1 uppercase">Contact</span>
            </div>
            <div class="flex-grow h-0.5 bg-slate-700 mx-4"></div>
            <div id="step2-indicator" class="flex flex-col items-center text-slate-600">
                <div class="w-8 h-8 rounded-full bg-slate-800 text-slate-400 border border-slate-600 flex items-center justify-center font-bold text-sm">2</div>
                <span class="text-[10px] font-bold mt-1 uppercase">Estimate</span>
            </div>
        </div>

        <div id="step1" class="step-section">
            <div class="glass-panel p-6 md:p-8">
                <h2 class="text-2xl font-bold mb-6">Start Your Project</h2>
                
                <div class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Full Name</label>
                            <input type="text" id="custName" placeholder="Enter your name" 
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Mobile Number</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-500">+91</span>
                                <input type="tel" id="custMobile" placeholder="9876543210" maxlength="10"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 pl-12 text-white focus:border-blue-500 outline-none font-mono">
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2">Drilling Site Location</label>
                        <div class="relative">
                            <i class="fa-solid fa-location-dot absolute left-3 top-3.5 text-blue-500"></i>
                            <input id="locationInput" type="text" placeholder="Search locality or landmark..." 
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 pl-10 text-white focus:border-blue-500 outline-none">
                        </div>
                    </div>

                    <button onclick="goToStep2()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl transition shadow-lg shadow-blue-500/20 mt-4">
                        Proceed to Estimator <i class="fa-solid fa-arrow-right ml-2"></i>
                    </button>
                    
                    <p class="text-[10px] text-center text-slate-500">
                        <i class="fa-solid fa-lock"></i> Your details are secure and used for estimation only.
                    </p>
                </div>
            </div>
        </div>

        <div id="step2" class="step-section hidden-step">
            <div class="glass-panel p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Estimation Details</h2>
                    <button onclick="goBack()" class="text-xs text-slate-400 hover:text-white underline">Edit Contact</button>
                </div>

                <div class="mb-8">
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-3">Purpose of Drilling</label>
                    <div class="grid grid-cols-3 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="purpose" value="residential" class="peer hidden" checked onchange="updateRateCard()">
                            <div class="p-3 rounded-lg bg-slate-800 border border-slate-700 peer-checked:border-blue-500 peer-checked:bg-blue-900/20 text-center transition">
                                <i class="fa-solid fa-house mb-2 text-slate-400 peer-checked:text-blue-400"></i>
                                <p class="text-xs font-bold">Residential</p>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="purpose" value="agriculture" class="peer hidden" onchange="updateRateCard()">
                            <div class="p-3 rounded-lg bg-slate-800 border border-slate-700 peer-checked:border-green-500 peer-checked:bg-green-900/20 text-center transition">
                                <i class="fa-solid fa-wheat-awn mb-2 text-slate-400 peer-checked:text-green-400"></i>
                                <p class="text-xs font-bold">Agriculture</p>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="purpose" value="commercial" class="peer hidden" onchange="updateRateCard()">
                            <div class="p-3 rounded-lg bg-slate-800 border border-slate-700 peer-checked:border-purple-500 peer-checked:bg-purple-900/20 text-center transition">
                                <i class="fa-solid fa-building mb-2 text-slate-400 peer-checked:text-purple-400"></i>
                                <p class="text-xs font-bold">Commercial</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="mb-8 p-5 bg-slate-800/50 rounded-xl border border-slate-700/50">
                    <div class="flex justify-between items-end mb-4">
                        <label class="text-sm font-bold text-slate-300">Estimated Depth</label>
                        <div class="flex items-center">
                            <input type="number" id="depthInput" value="500" min="100" max="1500" 
                                class="w-24 bg-slate-900 border border-blue-500/50 rounded p-2 text-right font-bold text-white text-lg outline-none focus:ring-2 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-slate-500 font-bold">ft</span>
                        </div>
                    </div>
                    
                    <input type="range" id="depthSlider" min="100" max="1500" value="500" step="10" 
                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                    
                    <div class="flex justify-between mt-2 text-[10px] text-slate-500 uppercase font-bold tracking-wider">
                        <span>100 ft</span>
                        <span>1500 ft</span>
                    </div>
                </div>

                <div class="border-t-2 border-slate-700 pt-6">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-slate-400">Drilling Estimation</span>
                        <span class="text-3xl font-extrabold text-white" id="totalPrice">â‚¹0</span>
                    </div>
                    <p class="text-[10px] text-right text-slate-500 mb-6">*Excluding GST & Transport</p>

                    <details class="mb-6 group">
                        <summary class="text-xs text-blue-400 cursor-pointer list-none flex items-center gap-2 font-bold">
                            <i class="fa-solid fa-circle-info"></i> View Rate Breakdown (50ft Slabs)
                        </summary>
                        <div class="mt-3 p-3 bg-slate-900 rounded text-xs text-slate-400 space-y-1 font-mono border border-slate-700" id="breakdownLog">
                            </div>
                    </details>

                    <button onclick="submitLead()" class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl transition shadow-lg shadow-emerald-500/20 flex justify-center items-center gap-2">
                        <i class="fa-brands fa-whatsapp text-xl"></i> Get Detailed Quote on WhatsApp
                    </button>
                </div>
            </div>
        </div>

    </main>

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places" async defer></script>

    <script>
        // --- 1. JUMPING RATE CONFIGURATION (The 50ft Slabs) ---
        // This simulates the "Rate 1, Rate 2" logic.
        // You can adjust these base prices.
        const SLAB_INCREMENT = 50; // Every 50ft
        
        // Base Rates for the first slab (0-50ft) based on Purpose
        const BASE_RATES = {
            'residential': 90,
            'agriculture': 85, // Usually slightly cheaper for bulk depth
            'commercial': 110
        };

        // How much the price increases per slab (The "Jump")
        // e.g., if JUMP_AMOUNT is 5, then:
        // 0-50ft = 90
        // 51-100ft = 95
        // 101-150ft = 100
        const JUMP_AMOUNT = 5; 

        // --- 2. LEAD DATA STORAGE ---
        let leadData = {
            name: "",
            mobile: "",
            location: "",
            purpose: "residential",
            depth: 500,
            price: 0
        };

        // --- 3. GOOGLE PLACES SETUP ---
        window.onload = function() {
            const input = document.getElementById("locationInput");
            if(window.google) {
                const autocomplete = new google.maps.places.Autocomplete(input);
                autocomplete.addListener("place_changed", () => {
                    const place = autocomplete.getPlace();
                    leadData.location = place.formatted_address || input.value;
                });
            }
        };

        // --- 4. STEP NAVIGATION ---
        function goToStep2() {
            const name = document.getElementById('custName').value;
            const mobile = document.getElementById('custMobile').value;
            const loc = document.getElementById('locationInput').value;

            // Validation
            if(name.length < 3) return alert("Please enter valid name");
            if(mobile.length < 10) return alert("Please enter valid mobile number");
            if(loc.length < 3) return alert("Please enter location");

            // Save Data
            leadData.name = name;
            leadData.mobile = mobile;
            leadData.location = loc;

            // Switch UI
            document.getElementById('step1').classList.add('hidden-step');
            setTimeout(() => {
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('step2').classList.remove('hidden-step');
                }, 50);
            }, 400);

            // Update Header Indicators
            document.getElementById('step1-indicator').className = "flex flex-col items-center text-slate-500";
            document.getElementById('step1-indicator').children[0].className = "w-8 h-8 rounded-full bg-slate-800 text-slate-400 border border-slate-600 flex items-center justify-center font-bold text-sm";
            
            document.getElementById('step2-indicator').className = "flex flex-col items-center text-blue-500";
            document.getElementById('step2-indicator').children[0].className = "w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm";

            // Run Calc
            calculatePrice();
            
            // SILENT LEAD CAPTURE (Simulated)
            // In a real app, here we would do: fetch('/api/save-lead', { ... })
            console.log("Lead Captured:", leadData); 
        }

        function goBack() {
            location.reload(); // Simple reload to restart
        }

        // --- 5. CALCULATOR ENGINE (DUAL INPUT + SLABS) ---
        const slider = document.getElementById('depthSlider');
        const numberInput = document.getElementById('depthInput');
        const priceDisplay = document.getElementById('totalPrice');
        const breakdownLog = document.getElementById('breakdownLog');

        // Sync Slider & Number Input
        slider.addEventListener('input', (e) => {
            numberInput.value = e.target.value;
            calculatePrice();
        });
        numberInput.addEventListener('input', (e) => {
            let val = parseInt(e.target.value);
            if(val > 1500) val = 1500; // Max Limit
            slider.value = val;
            calculatePrice();
        });

        function updateRateCard() {
            const radios = document.getElementsByName('purpose');
            for(let r of radios) {
                if(r.checked) leadData.purpose = r.value;
            }
            calculatePrice();
        }

        function calculatePrice() {
            const depth = parseInt(numberInput.value) || 0;
            const startRate = BASE_RATES[leadData.purpose];
            let totalCost = 0;
            let currentSlabRate = startRate;
            let logHTML = "";

            // LOGIC: Loop through every 50ft
            // If depth is 120ft:
            // Slab 1 (0-50): 50 * Rate1
            // Slab 2 (51-100): 50 * Rate2
            // Slab 3 (101-120): 20 * Rate3

            let remainingDepth = depth;
            let currentDepthFloor = 0;

            while (remainingDepth > 0) {
                let depthInThisSlab = 0;
                
                if (remainingDepth >= SLAB_INCREMENT) {
                    depthInThisSlab = SLAB_INCREMENT;
                } else {
                    depthInThisSlab = remainingDepth;
                }

                const slabCost = depthInThisSlab * currentSlabRate;
                totalCost += slabCost;

                // Log for breakdown
                const slabLabel = `${currentDepthFloor}-${currentDepthFloor + depthInThisSlab}ft`;
                logHTML += `<div class="flex justify-between"><span>${slabLabel} (@ â‚¹${currentSlabRate})</span> <span>â‚¹${slabCost.toLocaleString()}</span></div>`;

                // Prepare next slab
                remainingDepth -= depthInThisSlab;
                currentDepthFloor += depthInThisSlab;
                currentSlabRate += JUMP_AMOUNT; // Price jumps every slab
            }

            priceDisplay.innerText = "â‚¹" + totalCost.toLocaleString();
            breakdownLog.innerHTML = logHTML;
            leadData.price = totalCost;
            leadData.depth = depth;
        }

       function submitLead() {
            const btn = document.querySelector('button[onclick="submitLead()"]');
            const originalText = btn.innerHTML;
            
            // 1. Show Loading State
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Saving...';
            btn.disabled = true;
        
            // 2. Prepare Data for Google Sheet
            const formData = new FormData();
            formData.append("name", leadData.name);
            formData.append("mobile", leadData.mobile);
            formData.append("location", leadData.location);
            formData.append("purpose", leadData.purpose);
            formData.append("depth", leadData.depth);
            formData.append("price", leadData.price);
        
            // 3. Send to Backend (Google Script)
            fetch(CONTACT_INFO.database_url, {
                method: "POST",
                body: formData,
                mode: "no-cors" // Important for Google Script
            })
            .then(() => {
                // 4. Success! Now open WhatsApp
                btn.innerHTML = '<i class="fa-solid fa-check"></i> Saved!';
                
                // Generate WhatsApp Message
                const msg = `*New Quote Request*%0A%0AðŸ‘¤ Name: ${leadData.name}%0AðŸ“± Mobile: ${leadData.mobile}%0AðŸ“ Loc: ${leadData.location}%0A%0Aâš™ï¸ *Job Details:*%0A- Purpose: ${leadData.purpose.toUpperCase()}%0A- Depth: ${leadData.depth} ft%0A- Est. Cost: â‚¹${leadData.price.toLocaleString()}%0A%0APlease contact me.`;
                
                setTimeout(() => {
                    window.open(`https://wa.me/${CONTACT_INFO.whatsapp_api}?text=${msg}`, '_blank');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1000);
            })
            .catch(err => {
                console.error("Error saving lead", err);
                alert("Connection error, opening WhatsApp directly.");
                // Fallback: Open WhatsApp anyway
                const msg = `*New Quote Request (Offline)*%0A%0AðŸ‘¤ Name: ${leadData.name}%0AðŸ“± Mobile: ${leadData.mobile}%0A...`;
                window.open(`https://wa.me/${CONTACT_INFO.whatsapp_api}?text=${msg}`, '_blank');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
