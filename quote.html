<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Estimate | Sagar Borewells</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: #334155; }
        
        /* The "TorQ" Style Card */
        .est-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .est-header { background: #2563eb; color: white; padding: 24px; }
        .est-body { padding: 24px; }
        
        /* Table Styles */
        .est-table { width: 100%; font-size: 13px; border-collapse: collapse; margin-bottom: 20px; }
        .est-table th { text-align: left; padding: 8px 0; color: #64748b; font-size: 11px; text-transform: uppercase; border-bottom: 1px solid #e2e8f0; }
        .est-table td { padding: 12px 0; border-bottom: 1px solid #f1f5f9; color: #0f172a; font-weight: 600; }
        .est-table .subtotal-row td { border-top: 2px solid #e2e8f0; border-bottom: none; font-size: 14px; color: #1e293b; padding-top: 16px; }

        /* Variable Grid */
        .var-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 11px; }
        .var-item { display: flex; justify-content: space-between; align-items: center; padding: 6px; background: #f8fafc; border-radius: 4px; }
        .var-badge { background: #e0f2fe; color: #0369a1; padding: 2px 6px; border-radius: 4px; font-weight: 700; }

        /* Input Styles */
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; }
        .input-dark:focus { border-color: #3b82f6; outline: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-slate-900">

    <div id="header-mount"></div>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        
        <div id="inputSection" class="bg-[#1e293b] rounded-2xl p-6 md:p-8 border border-slate-700 shadow-2xl">
            <h1 class="text-2xl font-bold text-white mb-6">Generate Official Estimate</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">Customer Name</label>
                        <input type="text" id="custName" placeholder="Enter Name" class="w-full mt-1 p-3 rounded-lg input-dark">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">Mobile Number</label>
                        <input type="tel" id="custMobile" placeholder="9876543210" class="w-full mt-1 p-3 rounded-lg input-dark font-mono">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase">Site Location</label>
                        <input type="text" id="locationInput" placeholder="Mangalagiri, AP" class="w-full mt-1 p-3 rounded-lg input-dark">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Drill Depth (ft)</label>
                            <input type="number" id="depthInput" value="500" class="w-full mt-1 p-3 rounded-lg input-dark font-bold text-blue-400">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase">Purpose</label>
                            <select id="purposeInput" class="w-full mt-1 p-3 rounded-lg input-dark">
                                <option value="residential">Residential</option>
                                <option value="agriculture">Agriculture</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="generateQuote()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl transition shadow-lg shadow-blue-500/20 flex justify-center items-center gap-2">
                <i class="fa-solid fa-calculator"></i> GENERATE QUOTE PREVIEW
            </button>
        </div>


        <div id="quoteResult" class="hidden mt-8">
            <div class="est-card">
                
                <div class="est-header">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-2xl font-extrabold tracking-tight">SAGAR <span class="text-blue-200">OPS</span></h2>
                            <span class="text-xs font-mono bg-blue-700 px-2 py-1 rounded text-blue-100">EST #PREVIEW</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-blue-200 uppercase font-bold">Estimated Total</div>
                            <div class="text-3xl font-bold" id="headerTotal">‚Çπ0</div>
                            <div class="text-[10px] text-blue-200">*Excl. Casing & GST</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-6 text-sm border-t border-blue-500 pt-4">
                        <div>
                            <span class="text-blue-300 text-xs uppercase block">Location</span>
                            <strong id="displayLoc">--</strong>
                        </div>
                        <div>
                            <span class="text-blue-300 text-xs uppercase block">Service</span>
                            <strong>6.5" High Pressure</strong>
                        </div>
                        <div>
                            <span class="text-blue-300 text-xs uppercase block">Depth</span>
                            <strong id="displayDepth">--</strong>
                        </div>
                    </div>
                </div>

                <div class="est-body">
                    
                    <div class="mb-8">
                        <div class="text-xs font-bold text-slate-400 uppercase mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-layer-group"></i> Drilling Cost Structure
                        </div>
                        <table class="est-table">
                            <thead>
                                <tr>
                                    <th>Depth Range</th>
                                    <th class="text-center">Rate</th>
                                    <th class="text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="drillingTableBody">
                                </tbody>
                            <tfoot>
                                <tr class="subtotal-row">
                                    <td colspan="2">Drilling Subtotal</td>
                                    <td class="text-right" id="drillingSubtotal">‚Çπ0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div class="mb-8">
                        <div class="text-xs font-bold text-slate-400 uppercase mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-truck-fast"></i> Fixed Operational Costs
                        </div>
                        <table class="est-table">
                            <tbody>
                                <tr>
                                    <td>Rig Setting & Transport</td>
                                    <td class="text-right">‚Çπ5,000</td>
                                </tr>
                                <tr>
                                    <td>Labor & Food Charges</td>
                                    <td class="text-right">‚Çπ2,000</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Fixed Costs Subtotal</td>
                                    <td class="text-right">‚Çπ7,000</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8">
                        <div class="flex gap-3 mb-3">
                            <i class="fa-solid fa-triangle-exclamation text-yellow-600 mt-0.5"></i>
                            <div>
                                <div class="text-xs font-bold text-slate-800 uppercase">Variable Materials</div>
                                <div class="text-[10px] text-slate-500">Charged based on actual site usage. NOT included in total above.</div>
                            </div>
                        </div>
                        
                        <div class="var-grid">
                            <div class="var-item"><span>6.5" PVC Pipe (Std)</span> <span class="var-badge">‚Çπ350/ft</span></div>
                            <div class="var-item"><span>6.5" PVC Pipe (Heavy)</span> <span class="var-badge">‚Çπ450/ft</span></div>
                            <div class="var-item"><span>7" MS Iron Casing</span> <span class="var-badge">‚Çπ650/ft</span></div>
                            <div class="var-item"><span>Welding Charge</span> <span class="var-badge">‚Çπ500/Joint</span></div>
                            <div class="var-item"><span>Cap & Collar</span> <span class="var-badge">‚Çπ450/Set</span></div>
                            <div class="var-item"><span>Water Injection</span> <span class="var-badge">‚Çπ15/ft</span></div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button onclick="submitBooking()" class="w-full max-w-sm py-4 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 transition mb-3">
                            Confirm Booking to Proceed
                        </button>
                        <p class="text-[10px] text-slate-400">VALID FOR 30 DAYS ‚Ä¢ COMPUTER GENERATED ESTIMATE</p>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <script src="assets/js/components.js"></script>

    <script>
        // --- CONFIGURATION ---
        const FIXED_COSTS = 7000; // Transport (5000) + Food (2000)
        
        // Slab Logic (Same as before)
        const SLAB_INCREMENT = 50; 
        const JUMP_AMOUNT = 5; 
        const BASE_RATES = { 'residential': 90, 'agriculture': 85, 'commercial': 110 };

        let quoteData = {};

        // --- PRE-FILL FROM MAP ---
        document.addEventListener("DOMContentLoaded", function() {
            const params = new URLSearchParams(window.location.search);
            if(params.get('loc')) {
                document.getElementById("locationInput").value = decodeURIComponent(params.get('loc'));
            }
        });

        // --- GENERATOR ENGINE ---
        function generateQuote() {
            // 1. Gather Inputs
            const name = document.getElementById('custName').value;
            const loc = document.getElementById('locationInput').value;
            const depth = parseInt(document.getElementById('depthInput').value) || 0;
            const purpose = document.getElementById('purposeInput').value;

            if(!name || !loc || depth < 100) {
                alert("Please fill all details correctly.");
                return;
            }

            // 2. Calculate Drilling Slabs
            let remaining = depth;
            let floor = 0;
            let currentRate = BASE_RATES[purpose];
            let drillTotal = 0;
            let tableHTML = "";

            while(remaining > 0) {
                let chunk = (remaining >= SLAB_INCREMENT) ? SLAB_INCREMENT : remaining;
                let chunkCost = chunk * currentRate;
                drillTotal += chunkCost;

                // Create Table Row
                tableHTML += `
                    <tr>
                        <td>${floor} - ${floor + chunk} ft</td>
                        <td class="text-center">‚Çπ${currentRate}</td>
                        <td class="text-right">‚Çπ${chunkCost.toLocaleString()}</td>
                    </tr>
                `;

                remaining -= chunk;
                floor += chunk;
                currentRate += JUMP_AMOUNT;
            }

            // 3. Final Math
            const grandTotal = drillTotal + FIXED_COSTS;

            // 4. Populate UI
            document.getElementById('displayLoc').innerText = loc;
            document.getElementById('displayDepth').innerText = depth + " ft";
            
            document.getElementById('drillingTableBody').innerHTML = tableHTML;
            document.getElementById('drillingSubtotal').innerText = "‚Çπ" + drillTotal.toLocaleString();
            
            document.getElementById('headerTotal').innerText = "‚Çπ" + grandTotal.toLocaleString();

            // 5. Show Result & Hide Input (Optional: Scroll to result)
            document.getElementById('quoteResult').classList.remove('hidden');
            document.getElementById('quoteResult').scrollIntoView({ behavior: 'smooth' });

            // Save for WhatsApp
            quoteData = { name, loc, depth, total: grandTotal };
        }

        // --- SUBMIT ---
        function submitBooking() {
            const btn = document.querySelector('button[onclick="submitBooking()"]');
            btn.innerHTML = "Processing...";
            
            // Send to Google Sheet (using config.js URL)
            const formData = new FormData();
            formData.append("name", quoteData.name);
            formData.append("location", quoteData.loc);
            formData.append("depth", quoteData.depth);
            formData.append("price", quoteData.total);
            formData.append("purpose", "Official Quote");

            fetch(CONTACT_INFO.database_url, { method: "POST", body: formData, mode: "no-cors" })
            .then(() => {
                const msg = `*OFFICIAL BOOKING*%0A%0Aüë§ ${quoteData.name}%0Aüìç ${quoteData.loc}%0Aüìâ Depth: ${quoteData.depth}ft%0Aüí∞ *Est. Total:* ‚Çπ${quoteData.total.toLocaleString()}%0A%0A(Includes Fixed Costs. Excl Casing).`;
                window.open(`https://wa.me/${CONTACT_INFO.whatsapp_api}?text=${msg}`, '_blank');
                btn.innerHTML = "Booking Sent!";
            });
        }
    </script>
</body>
</html>
