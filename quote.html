<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Quote | Sagar Borewells</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #0f172a; }
        
        /* Modal Transition */
        .modal-wrap { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-wrap.active { opacity: 1; pointer-events: auto; }
        .modal-content { transform: translateY(20px); transition: transform 0.3s ease; }
        .modal-wrap.active .modal-content { transform: translateY(0); }

        /* Invoice Styling */
        .invoice-paper { background: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid #e2e8f0; }
        .est-table th { text-align: left; padding: 8px; font-size: 11px; text-transform: uppercase; color: #64748b; background: #f1f5f9; }
        .est-table td { padding: 8px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <nav class="bg-white border-b border-slate-200 p-4 sticky top-0 z-30">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-lg font-bold text-slate-900 flex items-center gap-2">
                <i class="fa-solid fa-arrow-left text-slate-400"></i> Back
            </a>
            <span class="text-xs font-bold bg-blue-100 text-blue-700 px-3 py-1 rounded-full">ESTIMATOR TOOL</span>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto p-4 py-8">
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8">
            <h1 class="text-2xl font-bold text-slate-900 mb-6">Project Details</h1>

            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Customer Name</label>
                        <input type="text" id="custName" placeholder="Enter Name" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:border-blue-500 outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Mobile Number</label>
                        <input type="tel" id="custMobile" placeholder="9876543210" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:border-blue-500 outline-none transition">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Drilling Site Location</label>
                    <div class="flex gap-2">
                        <input type="text" id="locInput" placeholder="Enter Location or use GPS" class="flex-grow p-3 bg-slate-50 border border-slate-200 rounded-lg focus:border-blue-500 outline-none transition">
                        <button onclick="detectGPS()" class="px-4 bg-slate-200 hover:bg-slate-300 rounded-lg text-slate-600 transition"><i class="fa-solid fa-crosshairs"></i></button>
                    </div>
                </div>

                <div class="p-6 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="flex justify-between mb-4">
                        <label class="font-bold text-slate-700">Estimated Depth</label>
                        <span class="font-bold text-blue-600"><span id="depthDisplay">500</span> ft</span>
                    </div>
                    <input type="range" id="depthSlider" min="100" max="1500" value="500" step="10" class="w-full h-2 bg-slate-300 rounded-lg accent-blue-600 cursor-pointer" oninput="updateUI()">
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Purpose</label>
                            <select id="purposeInput" class="w-full p-2 bg-white border border-slate-200 rounded-lg" onchange="updateUI()">
                                <option value="residential">Residential</option>
                                <option value="agriculture">Agriculture</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Casing Type</label>
                            <select id="casingType" class="w-full p-2 bg-white border border-slate-200 rounded-lg">
                                <option value="PVC">PVC (Standard)</option>
                                <option value="Heavy">PVC (Heavy)</option>
                                <option value="Iron">MS Iron</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button onclick="generatePreview()" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 transition transform hover:scale-[1.01]">
                    Generate Official Quote
                </button>
            </div>
        </div>
    </main>

    <div id="previewModal" class="fixed inset-0 z-50 modal-wrap flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-2xl max-h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col modal-content">
            
            <div class="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                <h2 class="font-bold text-slate-700 flex items-center gap-2"><i class="fa-solid fa-file-invoice text-blue-600"></i> Estimate Preview</h2>
                <button onclick="closeModal()" class="text-sm font-bold text-blue-600 hover:underline">Edit Details</button>
            </div>

            <div class="flex-grow overflow-y-auto p-6 bg-slate-100">
                <div class="invoice-paper p-6 rounded-lg bg-white">
                    
                    <div class="flex justify-between border-b-2 border-slate-100 pb-4 mb-4">
                        <div>
                            <div class="text-xl font-extrabold text-blue-800">SAGAR OPS</div>
                            <div class="text-xs text-slate-500">Official Cost Estimate</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-slate-400 uppercase font-bold">Total Estimate</div>
                            <div class="text-2xl font-bold text-slate-900" id="invTotal">‚Çπ0</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6 text-xs">
                        <div>
                            <span class="block text-slate-400 font-bold uppercase">Customer</span>
                            <span class="block text-slate-800 font-semibold" id="invName">--</span>
                        </div>
                        <div>
                            <span class="block text-slate-400 font-bold uppercase">Location</span>
                            <span class="block text-slate-800 font-semibold" id="invLoc">--</span>
                        </div>
                    </div>

                    <h3 class="text-xs font-bold text-slate-900 uppercase mb-2">1. Drilling Cost Breakdown</h3>
                    <table class="est-table w-full mb-6">
                        <thead><tr><th>Depth Slab</th><th class="text-right">Amount</th></tr></thead>
                        <tbody id="drillingBody"></tbody>
                    </table>

                    <h3 class="text-xs font-bold text-slate-900 uppercase mb-2">2. Fixed Operational Costs</h3>
                    <table class="est-table w-full mb-6">
                        <tbody>
                            <tr>
                                <td>Transport, Setup, Labor & Food</td>
                                <td class="text-right font-bold text-slate-700">‚Çπ7,000</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="bg-yellow-50 p-3 rounded border border-yellow-100 text-[11px] text-yellow-800 mb-2">
                        <strong>Note:</strong> Casing Pipe (<span id="invCasing">PVC</span>) & GST are charged extra based on actual usage.
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white border-t border-slate-200">
                <button onclick="sendWhatsApp()" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg shadow-lg flex justify-center items-center gap-2">
                    <i class="fa-brands fa-whatsapp text-lg"></i> Confirm & Send Quote
                </button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const FIXED_COSTS = 7000;
        const SLAB_INCREMENT = 50;
        const JUMP_AMOUNT = 5;
        const BASE_RATES = { 'residential': 90, 'agriculture': 85, 'commercial': 110 };
        
        let leadData = {};

        // 1. UI UPDATES
        function updateUI() {
            document.getElementById('depthDisplay').innerText = document.getElementById('depthSlider').value;
        }

        // 2. LOCATION
        function detectGPS() {
            const btn = document.querySelector('button[onclick="detectGPS()"]');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    // In real app, use Geocoder here. For now, simple lat/lng
                    document.getElementById('locInput').value = `${pos.coords.latitude.toFixed(5)}, ${pos.coords.longitude.toFixed(5)}`;
                    btn.innerHTML = '<i class="fa-solid fa-check"></i>';
                }, () => { alert('GPS Denied'); btn.innerHTML = '<i class="fa-solid fa-crosshairs"></i>'; });
            }
        }

        // 3. GENERATE PREVIEW (Opens Modal)
        function generatePreview() {
            // Get Values
            const name = document.getElementById('custName').value;
            const mobile = document.getElementById('custMobile').value;
            const loc = document.getElementById('locInput').value;
            const depth = parseInt(document.getElementById('depthSlider').value);
            const purpose = document.getElementById('purposeInput').value;
            const casing = document.getElementById('casingType').value;

            if(!name || !loc) { alert("Please enter Name and Location"); return; }

            // Calc Logic
            let remaining = depth;
            let floor = 0;
            let rate = BASE_RATES[purpose];
            let drillTotal = 0;
            let rows = "";

            while(remaining > 0) {
                let chunk = (remaining >= SLAB_INCREMENT) ? SLAB_INCREMENT : remaining;
                let cost = chunk * rate;
                drillTotal += cost;
                
                rows += `<tr>
                    <td>${floor}-${floor+chunk}ft @ ‚Çπ${rate}</td>
                    <td class="text-right">‚Çπ${cost.toLocaleString()}</td>
                </tr>`;

                remaining -= chunk;
                floor += chunk;
                rate += JUMP_AMOUNT;
            }

            const grandTotal = drillTotal + FIXED_COSTS;

            // Fill Modal
            document.getElementById('invName').innerText = name;
            document.getElementById('invLoc').innerText = loc;
            document.getElementById('invCasing').innerText = casing;
            document.getElementById('drillingBody').innerHTML = rows;
            document.getElementById('invTotal').innerText = "‚Çπ" + grandTotal.toLocaleString();

            // Store Data
            leadData = { name, mobile, loc, depth, total: grandTotal };

            // Show Modal
            document.getElementById('previewModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // 4. SEND
        function sendWhatsApp() {
            // Send to Google Sheet logic can go here (fetch call)
            
            const msg = `*OFFICIAL QUOTE*%0A%0Aüë§ ${leadData.name}%0Aüìç ${leadData.loc}%0Aüìû ${leadData.mobile}%0A%0Aüìâ Depth: ${leadData.depth}ft%0Aüí∞ *Total Est:* ‚Çπ${leadData.total.toLocaleString()}%0A%0A(Includes Fixed Costs). Please confirm.`;
            window.open(`https://wa.me/${CONTACT_INFO.whatsapp_api}?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
